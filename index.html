<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Robert's Rules Order Counter</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --eus-red: #D72B2B;
      --eus-red-hover: #C12828;
      --eus-gray: #6A6A6A;
      --eus-gray-hover: #555555;
      --bg-light: #f5f5f5;
      --bg-dark: #000;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --border-radius: 4px;
      --transition-speed: 0.25s;
      --circle-stroke-width: 10;
      --circle-radius: 50;
      --circle-circumference: 314.159; /* 2 * œÄ * 50 = 314.159 */    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0; padding: 0;
      background: var(--bg-light);
      font-size: 14px; color: #333;
      transition: background 0.3s, color 0.3s;
    }

    /* ===== Intro / Password Gate ===== */
    #gate {
      position: fixed; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background:
        radial-gradient(1200px 600px at 20% 20%, rgba(215,43,43,0.12), transparent 60%),
        radial-gradient(1000px 500px at 80% 30%, rgba(163,31,39,0.12), transparent 60%),
        #0b0b0b;
      z-index: 9999;
    }
    #gate .card {
      width: min(92vw, 540px);
      background: #111; color: #fff;
      border: 1px solid #2a2a2a;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      padding: 26px 22px;
      text-align: center;
    }
    #gate h1 { margin: 0 0 6px; font-size: 1.7rem; letter-spacing: .2px; }
    #gate h2 { margin: 4px 0 16px; font-weight: 500; color: #e8e8e8; font-size: 1.1rem; }
    #gate img.logo {
      width: 300px; height: auto; margin: 8px auto 8px; display: block;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.35));
      user-select: none; -webkit-user-drag: none;
    }
    #gate .names { margin-top: 4px; font-size: .98rem; color: #d0d0d0; }
    #gate .input-row {
      margin-top: 18px; display: flex; gap: 8px; align-items: center; justify-content: center;
    }
    #gate input[type="password"] {
      flex: 1; min-width: 0;
      background: #0b0b0b; color: #fff;
      border: 1px solid #333; border-radius: 10px;
      padding: 10px 12px; font-size: 1rem; outline: none;
      transition: border .2s, box-shadow .2s;
    }
    #gate input[type="password"]::placeholder { color: #9a9a9a; }
    #gate input[type="password"]:focus {
      border-color: var(--eus-red);
      box-shadow: 0 0 0 3px rgba(215,43,43,0.15);
    }
    #gate button.enter {
      background: var(--eus-red); color: #fff; border: none;
      padding: 10px 14px; border-radius: 10px; font-size: 1rem; cursor: pointer;
      transition: transform var(--transition-speed), background var(--transition-speed);
      min-width: 120px;
    }
    #gate button.enter:hover { background: var(--eus-red-hover); transform: translateY(-1px); }
    #gate .error { margin-top: 10px; color: #ff6b6b; min-height: 1.2em; font-size: .95rem; }
    #gate .footnote { margin-top: 14px; font-size: .85rem; color: #9a9a9a; }

    /* Hide app until unlocked */
    #app { display: none; }

    header {
      position: relative; width: 100%;
      background: linear-gradient(135deg, var(--eus-red), #A31F27);
      padding: 12px 0; box-shadow: var(--box-shadow);
    }
    header h1 { text-align: center; margin: 0; color: #fff; font-size: 1.9em; }

    /* Dark mode toggle */
    .toggle-switch { position: absolute; top: 10px; right: 10px; width: 60px; height: 30px; }
    .toggle-switch input { display: none; }
    .toggle-switch label {
      display: block; width: 100%; height: 100%; background: #ccc; border-radius: 15px;
      position: relative; cursor: pointer; transition: background 0.3s;
    }
    .toggle-switch .toggle-knob {
      position: absolute; top: 2px; left: 2px; width: 26px; height: 26px; background: #fff;
      border-radius: 50%; transition: left 0.3s; z-index: 2;
    }
    .toggle-switch input:checked + label { background: var(--eus-red); }
    .toggle-switch input:checked + label .toggle-knob { left: 32px; }

    /* Layout */
    main { display: flex; flex-direction: row; padding: 8px 8px 50px 8px; gap: 8px; width: 100%; }
    .left-panel { flex: 2; padding: 8px; }
    .right-panel { flex: 1; padding: 8px; }
    @media (max-width: 768px) {
      main { 
        flex-direction: column;
        padding: 4px 4px 60px 4px;
      }
      .left-panel, .right-panel { 
        width: 100%;
        padding: 4px;
      }
      
      /* Larger touch targets for mobile */
      button { 
        padding: 12px 16px;
        font-size: 1.05em;
        min-height: 44px; /* Apple's recommended touch target */
      }
      
      input[type="text"], input[type="number"] { 
        padding: 12px;
        font-size: 1.05em;
        min-height: 44px;
      }
      
      .custom-time-container input { 
        width: 100px;
        padding: 12px;
      }
      
      /* Larger preset buttons */
      #timerControls1 button,
      #timerControls2 button {
        padding: 10px 14px;
        min-width: 85px;
      }
      
      /* Better queue item spacing */
      .speaker-item {
        padding: 10px 8px;
      }
      
      .speaker-item-name {
        font-size: 1.05em;
      }
      
      .speaker-item button {
        padding: 8px 10px;
        font-size: 0.95em;
        min-height: 36px;
        min-width: 36px;
      }
      
      /* Stack queue columns on small screens */
      .queue-container {
        flex-direction: column;
      }
      
      .queue-container .column {
        width: 100%;
      }
      
      /* Larger current speaker display */
      #currentSpeakerDisplay {
        font-size: 1.8em;
        padding: 16px;
      }
      
      /* Larger timers on mobile */
      svg#timerCircle1, svg#timerCircle2 {
        width: 180px;
        height: 180px;
      }
      
      /* Keyboard shortcuts button */
      #keyboardShortcutsBtn {
        bottom: 60px;
        right: 10px;
        font-size: 1.1em;
        padding: 10px 14px;
      }
      
      /* Better notification placement */
      #notification {
        top: 70px;
        right: 10px;
        left: 10px;
        min-width: auto;
        font-size: 1em;
      }
    }

    /* Extra small phones */
    @media (max-width: 480px) {
      header h1 {
        font-size: 1.4em;
      }
      
      h2 {
        font-size: 1.15em;
      }
      
      .toggle-switch {
        top: 8px;
        right: 8px;
        width: 50px;
        height: 25px;
      }
      
      .toggle-switch .toggle-knob {
        width: 21px;
        height: 21px;
      }
      
      .toggle-switch input:checked + label .toggle-knob {
        left: 27px;
      }
      
      /* Smaller timer preset buttons */
      #timerControls1 button,
      #timerControls2 button {
        padding: 8px 10px;
        min-width: 75px;
        font-size: 0.95em;
      }
    }

    /* Sections */
    section {
      background: #fff; 
      padding: 16px; 
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow); 
      border: 1px solid #ddd; 
      margin-bottom: 12px;
      transition: background 0.3s, border-color 0.3s;
    }
    
    body.dark-mode h2 { 
      color: #fff;
      border-bottom-color: #fff;
    }

    h2 { margin: 0 0 12px; font-size: 1.3em; color: var(--eus-red); }

    /* Inputs */
    .flex-container { display: flex; justify-content: space-between; gap: 12px; flex-wrap: wrap; padding: 0 8px; }
    .column { flex: 1; min-width: 220px; }
    input[type="text"], input[type="number"] {
      width: 100%; padding: 8px; margin: 4px 0; border: 1px solid #ccc; border-radius: var(--border-radius);
      transition: border 0.2s;
    }
    input[type="text"]:focus, input[type="number"]:focus { border-color: var(--eus-red); outline: none; }

    /* Queue */
    .queue-container { display: flex; flex-direction: row; gap: 8px; padding: 0 8px; flex-wrap: nowrap; }
    .queue-container .column { width: 48%; }
    .queue-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; padding: 0 8px; }
    .queue-header h3 { margin: 0; font-size: 1.15em; }
    .clear-btn { padding: 6px 8px; font-size: 1em; }
    .queue-list {
      list-style: none; padding: 8px; border: 1px solid #ccc; border-radius: var(--border-radius);
      min-height: 60px; background: #fafafa; font-size: 0.9em; margin: 0 8px;
    }
    .queue-list li { padding: 4px 0; border-bottom: 1px solid #eee; }
    .queue-list li:last-child { border-bottom: none; }
    .skipped { text-decoration: line-through; }

    /* Buttons */
    button {
      padding: 8px 12px; margin: 4px 0; border: none; border-radius: var(--border-radius);
      cursor: pointer; font-size: 1em; color: #fff;
      transition: background var(--transition-speed), transform var(--transition-speed);
    }
    button:hover { transform: scale(1.02); }
    button.default, button:not(.start-btn):not(.stop-btn) { background: var(--eus-red); }
    button.default:hover, button:not(.start-btn):not(.stop-btn):hover { background: var(--eus-red-hover); }
    .preset { background: var(--eus-red); }
    .preset:hover { background: var(--eus-red-hover); }
    .start-btn { background: var(--eus-red); }
    .start-btn:hover { background: var(--eus-red-hover); }
    .stop-btn { background: var(--eus-gray); }
    .stop-btn:hover { background: var(--eus-gray-hover); }
    #resetTimerBtn1, #resetTimerBtn2 { background: #888; }
    #resetTimerBtn1:hover, #resetTimerBtn2:hover { background: #777; }
    #nextSpeakerBtn { min-height: 40px; }

    /* Timers */
    .circle-container { display: flex; justify-content: center; align-items: center; margin-bottom: 12px; }
    svg#timerCircle1, svg#timerCircle2 { width: 140px; height: 140px; }
    circle.timer-bg { fill: none; stroke: #ccc; stroke-width: var(--circle-stroke-width); }
    circle.timer-progress {
      fill: none; stroke: var(--eus-red); stroke-width: var(--circle-stroke-width);
      stroke-dasharray: var(--circle-circumference); stroke-dashoffset: 0;
      transition: stroke-dashoffset 0.25s linear;
    }
    text#timerDisplay1, text#timerDisplay2 { fill: #333; font-size: 20px; text-anchor: middle; dominant-baseline: middle; }

    /* Presets & Custom time rows */
    #timerControls1, #timerControls2 { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 0 4px 12px; }
    .custom-time-container { display: flex; justify-content: center; align-items: center; gap: 8px; margin: 0 4px 12px; }
    .custom-time-container input { width: 80px; padding: 8px; }

    /* Footer */
    #footer {
      position: fixed; bottom: 0; right: 0; margin: 10px;
      font-size: 0.85em; color: #333; opacity: 0.5; z-index: 1000; transition: color 0.3s;
    }

    /* Dark mode */
    body.dark-mode { background: #000; color: #fff; }
    body.dark-mode header { background: #111; }
    body.dark-mode section { background: #111; border-color: #333; }
    body.dark-mode input, body.dark-mode button { border-color: #333; }
    body.dark-mode .queue-list { background: #111; border-color: #333; }
    body.dark-mode svg#timerCircle1 circle.timer-bg,
    body.dark-mode svg#timerCircle2 circle.timer-bg { stroke: #333; }
    body.dark-mode svg#timerCircle1 circle.timer-progress,
    body.dark-mode svg#timerCircle2 circle.timer-progress { stroke: var(--eus-red); }
    body.dark-mode svg#timerCircle1 text#timerDisplay1,
    body.dark-mode svg#timerCircle2 text#timerDisplay2 { fill: #fff; }
    body.dark-mode #footer { color: #fff; }
    body.dark-mode .toggle-switch label { background: #666; }
    body.dark-mode .toggle-switch label:hover { background: #666; }

    /* Current speaker */
    #currentSpeakerDisplay {
      font-size: 1.5em; padding: 12px; background: #e9ecef; border-radius: 3px; text-align: center; margin: 0 8px;
    }
    body.dark-mode #currentSpeakerDisplay { background: #333; color: #fff; }

    /* Speaker list item controls */
  .speaker-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 8px;
    border-bottom: 1px solid #eee;
    transition: background 0.2s;
  }
  .speaker-item:hover {
    background: #f0f0f0;
  }
  body.dark-mode .speaker-item:hover {
    background: #222;
  }
  .speaker-item-name {
    flex: 1;
    margin-right: 8px;
  }
  .speaker-item button {
    padding: 4px 8px;
    font-size: 0.85em;
    min-width: auto;
    margin: 0;
  }
  .skip-btn {
    background: var(--eus-gray);
  }
  .skip-btn:hover {
    background: var(--eus-gray-hover);
  }
  .remove-btn {
    background: #d9534f;
  }
  .remove-btn:hover {
    background: #c9302c;
  }

  /* Timer warning states */
  .timer-warning circle.timer-progress {
    stroke: #ff9800;
  }
  .timer-critical circle.timer-progress {
    stroke: #f44336;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }
  .timer-critical svg {
    animation: pulse 1s infinite;
  }

  /* Accessible notification toast */
  #notification {
    position: fixed;
    top: 80px;
    right: 20px;
    padding: 16px 20px;
    background: var(--eus-red);
    color: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    font-size: 1.1em;
    font-weight: 500;
    z-index: 10000;
    display: none;
    min-width: 250px;
  }
  #notification.show {
    display: block;
    animation: slideIn 0.3s ease-out;
  }
  @keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  /* Reorder buttons */
  .reorder-btn {
    background: var(--eus-gray);
    padding: 2px 6px;
    font-size: 0.75em;
    min-width: 24px;
  }
  .reorder-btn:hover {
    background: var(--eus-gray-hover);
  }
  .reorder-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  /* Undo button styling */
  #undoBtn {
    background: #5cb85c;
  }
  #undoBtn:hover:not(:disabled) {
    background: #4cae4c;
  }
  #undoBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Speaker item spacing for new buttons */
  .speaker-item-controls {
    display: flex;
    gap: 3px;
    flex-wrap: nowrap;
  }

  /* Logo fallback styling */
  .logo-fallback {
    text-align: center;
    letter-spacing: 4px;
    text-transform: uppercase;
    padding: 20px;
    border: 2px solid var(--eus-red);
    border-radius: 10px;
    display: inline-block;
    margin: 20px auto;
  }

  /* Sound toggle button */
  #soundToggle {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background 0.2s;
  }
  #soundToggle:hover {
    background: rgba(255,255,255,0.3);
  }

  /* Better section alignment */

  
  @keyframes successPulse {
    0% { background: #fff; }
    50% { background: #d4edda; }
    100% { background: #fff; }
  }

  @keyframes successPulseDark {
    0% { background: #111; }
    50% { background: #1e4620; }
    100% { background: #111; }
  }
  
  .queue-list.success {
    animation: successPulse 0.5s ease;
  }

  body.dark-mode .queue-list.success {
    animation: successPulseDark 0.5s ease;
  }

  body.dark-mode #session-stats {
    background: #111;
    border-color: #333;
  }

  .stat-label {
    font-size: 0.9em;
    color: #666;
  }
  body.dark-mode #session-stats .stat-label {
    color: #999;
  }

  @media (max-width: 768px) {
    #soundToggle {
      top: 8px;
      left: 8px;
      font-size: 1.2em;
      padding: 8px 12px;
    }
    
    header h1 {
      font-size: 1.6em;
      padding: 0 50px;  /* Prevent overlap with buttons */
    }
  }
  </style>
</head>
<body>
  <!-- Intro / Password Gate -->
  <div id="gate" role="dialog" aria-modal="true">
    <div class="card">
      <h1>Robert‚Äôs Rules Counter</h1>
      <h2>Presented by</h2>
      <img class="logo" src="eus-logo.webp" alt="EUS logo" onerror="this.style.display='none'; document.querySelector('.logo-fallback').style.display='block';">
      <div class="logo-fallback" style="display:none; font-size:2rem; font-weight:700; color:var(--eus-red); margin:20px 0;">EUS</div>
      <div class="names">Cyril El Feghali &middot; Nicolas El Murr</div>

      <div class="input-row">
        <input id="pw" type="password" placeholder="Enter password" autocomplete="current-password" />
        <button class="enter" id="enterBtn">Enter</button>
      </div>
      <div id="pwError" class="error"></div>
      <div class="footnote">Access required to use this tool.</div>
      <div class="footnote"> Beta 1.7.0 </div>
    </div>
  </div>

  <!-- App (hidden until unlocked) -->
  <div id="app" aria-hidden="true">
    <div id="notification" role="alert" aria-live="assertive"></div>
    <header>
      <button id="soundToggle" aria-label="Toggle notification sound">üîä</button>
      <h1>Robert's Rules Order Counter</h1>
      <div class="toggle-switch">
        <input type="checkbox" id="themeToggle">
        <label for="themeToggle"><span class="toggle-knob"></span></label>
      </div>
    </header>

    <main>
      <!-- Left Panel: Speakers -->
      <div class="left-panel">
        <section id="add-speaker">
          <h2>Add Speaker</h2>
          <div class="flex-container">
            <div class="column">
              <h3>Priority 1 (New Point)</h3>
              <input type="text" id="speakerName1" placeholder="Enter speaker's name" />
              <button id="addSpeakerBtn1" class="default">Add Speaker</button>
            </div>
            <div class="column">
              <h3>Priority 2 (Response)</h3>
              <input type="text" id="speakerName2" placeholder="Enter speaker's name" />
              <button id="addSpeakerBtn2" class="default">Add Speaker</button>
            </div>
          </div>
        </section>

      <section id="queue">
        <h2>Speaking Queue</h2>
        <div class="queue-container">
          <div class="column">
            <div class="queue-header">
              <h3 id="priority1-heading">Priority 1</h3>
              <button id="clearOnesBtn" class="default clear-btn" aria-label="Clear all Priority 1 speakers">Clear 1's</button>
            </div>
            <ul id="speakerList1" class="queue-list" role="list" aria-labelledby="priority1-heading" aria-live="polite"></ul>
          </div>
          <div class="column">
            <div class="queue-header">
              <h3 id="priority2-heading">Priority 2</h3>
              <button id="clearTwosBtn" class="default clear-btn" aria-label="Clear all Priority 2 speakers">Clear 2's</button>
            </div>
            <ul id="speakerList2" class="queue-list" role="list" aria-labelledby="priority2-heading" aria-live="polite"></ul>
          </div>
        </div>
        <div style="display:flex; gap:8px; margin:8px; flex-wrap:wrap;">
          <button id="nextSpeakerBtn" class="default" style="flex:2; min-width:120px;" aria-label="Move to next speaker in queue">Next Speaker</button>
          <button id="clearAllDataBtn" class="stop-btn" style="flex:1; min-width:100px;">Clear All</button>
          <button id="undoBtn" style="flex:1; min-width:80px; background:#5cb85c;" disabled aria-label="Undo last action">‚Ü∂ Undo</button>
        </div>
      </section>

      <section id="currently-speaking">
        <h2>Currently Speaking</h2>
        <div id="currentSpeakerDisplay" role="status" aria-live="assertive" aria-atomic="true">None</div>
      </section>

      <section id="session-stats" style="padding: 8px 12px;">
        <h2>Session Statistics</h2>
        <div style="display: flex; justify-content: space-around; text-align: center; margin: 0 8px;">
          <div>
            <div style="font-size: 1.8em; font-weight: bold; color: var(--eus-red);" id="totalSpeakersCount">0</div>
            <div class="stat-label">Total Speakers</div>
          </div>
          <div>
            <div style="font-size: 1.8em; font-weight: bold; color: var(--eus-red);" id="queuedSpeakersCount">0</div>
            <div class="stat-label">In Queue</div>
          </div>
        </div>
      </section>
      </div>

      <!-- Right Panel: Timers -->
      <div class="right-panel">
        <section id="timerSection1" aria-label="Timer 1 controls">
          <h2>Timer 1</h2>
          <div class="circle-container" role="timer" aria-label="Timer 1 display">
            <svg id="timerCircle1" viewBox="0 0 120 120">
              <circle class="timer-bg" cx="60" cy="60" r="50" />
              <circle class="timer-progress" cx="60" cy="60" r="50" />
              <text id="timerDisplay1" x="50%" y="50%" text-anchor="middle" dominant-baseline="middle"></text>
            </svg>
          </div>
          <!-- Add aria-labels to all buttons -->
          <div id="timerControls1">
            <button class="preset" data-seconds="30" aria-label="Set timer to 30 seconds">30 secs</button>
            <button class="preset" data-seconds="45" aria-label="Set timer to 45 seconds">45 secs</button>
            <button class="preset" data-seconds="60" aria-label="Set timer to 1 minute">1 min</button>
            <button class="preset" data-seconds="120" aria-label="Set timer to 2 minutes">2 mins</button>
            <button class="preset" data-seconds="600" aria-label="Set timer to 10 minutes">10 mins</button>
            <button class="preset" data-seconds="900" aria-label="Set timer to 15 minutes">15 mins</button>
          </div>
          <div class="custom-time-container">
            <input type="number" id="customMinutes1" placeholder="Min" min="0" aria-label="Custom minutes for timer 1"/>
            <input type="number" id="customSeconds1" placeholder="Sec" min="0" aria-label="Custom seconds for timer 1"/>
            <button id="setCustomTimeBtn1" class="default" aria-label="Set custom time for timer 1">Set</button>
          </div>
          <button id="add30SecsBtn1" class="default" style="width:100%; margin:2px;" aria-label="Add 30 seconds to timer 1">Add 30 secs</button>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin:0 4px;">
            <button id="startTimerBtn1" class="start-btn" style="flex:1;" aria-label="Start timer 1">Start</button>
            <button id="pauseTimerBtn1" class="stop-btn" style="flex:1;" aria-label="Pause timer 1">Pause</button>
            <button id="resetTimerBtn1" style="flex:1;" aria-label="Reset timer 1">Reset</button>
          </div>
        </section>


        <section id="timerSection2">
          <h2>Timer 2</h2>
          <div class="circle-container">
            <svg id="timerCircle2" viewBox="0 0 120 120">
              <circle class="timer-bg" cx="60" cy="60" r="50" />
              <circle class="timer-progress" cx="60" cy="60" r="50" />
              <text id="timerDisplay2" x="50%" y="50%" text-anchor="middle" dominant-baseline="middle"></text>
            </svg>
          </div>
          <div id="timerControls2">
            <button class="preset" data-seconds="30">30 secs</button>
            <button class="preset" data-seconds="45">45 secs</button>
            <button class="preset" data-seconds="60">1 min</button>
            <button class="preset" data-seconds="120">2 mins</button>
            <button class="preset" data-seconds="600">10 mins</button>
            <button class="preset" data-seconds="900">15 mins</button>
          </div>
          <div class="custom-time-container">
            <input type="number" id="customMinutes2" placeholder="Min" min="0"/>
            <input type="number" id="customSeconds2" placeholder="Sec" min="0"/>
            <button id="setCustomTimeBtn2" class="default">Set</button>
          </div>
          <button id="add30SecsBtn2" class="default" style="width:100%; margin:2px;">Add 30 secs</button>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin:0 4px;">
            <button id="startTimerBtn2" class="start-btn" style="flex:1;">Start</button>
            <button id="pauseTimerBtn2" class="stop-btn" style="flex:1;">Pause</button>
            <button id="resetTimerBtn2" style="flex:1;">Reset</button>
          </div>
        </section>
      </div>
    </main>
    <button id="keyboardShortcutsBtn" style="position:fixed; bottom:40px; right:10px; padding:8px 12px; background:var(--eus-gray); color:#fff; border:none; border-radius:4px; cursor:pointer; z-index:1001;" aria-label="Show keyboard shortcuts">‚å®Ô∏è Shortcuts</button>

    <div id="shortcutsModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:10001; justify-content:center; align-items:center;">
      <div style="background:#fff; padding:28px; border-radius:12px; max-width:550px; width:90%; color:#333; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
        <h2 style="margin-top:0; text-align:center; color:var(--eus-red); border-bottom:2px solid var(--eus-red); padding-bottom:12px;">Keyboard Shortcuts</h2>
        <table style="width:100%; border-collapse:collapse;">
          <tr><td style="padding:8px; border-bottom:1px solid #ddd;"><strong>Space</strong></td><td style="padding:8px; border-bottom:1px solid #ddd;">Start/Pause Timer 1</td></tr>
          <tr><td style="padding:8px; border-bottom:1px solid #ddd;"><strong>N</strong></td><td style="padding:8px; border-bottom:1px solid #ddd;">Next Speaker</td></tr>
          <tr><td style="padding:8px; border-bottom:1px solid #ddd;"><strong>R</strong></td><td style="padding:8px; border-bottom:1px solid #ddd;">Reset Timer 1</td></tr>
          <tr><td style="padding:8px; border-bottom:1px solid #ddd;"><strong>M</strong></td><td style="padding:8px; border-bottom:1px solid #ddd;">Toggle Sound</td></tr>
          <tr><td style="padding:8px; border-bottom:1px solid #ddd;"><strong>Ctrl+Z</strong></td><td style="padding:8px; border-bottom:1px solid #ddd;">Undo Last Action</td></tr>
          <tr><td style="padding:8px; border-bottom:1px solid #ddd;"><strong>1</strong></td><td style="padding:8px; border-bottom:1px solid #ddd;">Focus Priority 1 input</td></tr>
          <tr><td style="padding:8px; border-bottom:1px solid #ddd;"><strong>2</strong></td><td style="padding:8px; border-bottom:1px solid #ddd;">Focus Priority 2 input</td></tr>
          <tr><td style="padding:8px;"><strong>Esc</strong></td><td style="padding:8px;">Close this dialog</td></tr>
        </table>
        <button onclick="document.getElementById('shortcutsModal').style.display='none'" style="margin-top:16px; padding:10px 20px; background:var(--eus-red); color:#fff; border:none; border-radius:4px; cursor:pointer;">Close</button>
      </div>
    </div>

    <div id="footer">Created by: C. El Feghali &amp; N. El Murr</div>
  </div>

  <script>
    /* ===== Password Gate ===== */
    const gate = document.getElementById('gate');
    const app = document.getElementById('app');
    const pwInput = document.getElementById('pw');
    const pwError = document.getElementById('pwError');
    const enterBtn = document.getElementById('enterBtn');
    const WORDINGG = 'eus';

    function showApp() {
      gate.style.display = 'none';
      app.style.display = 'block';
      app.setAttribute('aria-hidden', 'false');
      // focus first useful control
      const nameBox = document.getElementById('speakerName1');
      if (nameBox) nameBox.focus();
    }
    function checkSession() {
      if (sessionStorage.getItem('eus_authed') === '1') {
        showApp();
      }
    }
    function tryUnlock() {
      const val = (pwInput.value || '').trim();
      if (val === WORDINGG) {
        sessionStorage.setItem('eus_authed', '1');
        showApp();
      } else {
        pwError.textContent = 'Incorrect password. Try again.';
      }
    }
    enterBtn.addEventListener('click', tryUnlock);
    pwInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') tryUnlock();
    });
    checkSession();

    /* ===== Dark Mode Toggle ===== */
    document.getElementById('themeToggle').addEventListener('change', function () {
      if (this.checked) document.body.classList.add('dark-mode');
      else document.body.classList.remove('dark-mode');
    });

    /* ===== Local Storage Helper Functions ===== */
    function saveToStorage() {
      try {
        localStorage.setItem('queueOnes', JSON.stringify(queueOnes));
        localStorage.setItem('queueTwos', JSON.stringify(queueTwos));
        localStorage.setItem('currentSpeaker', document.getElementById('currentSpeakerDisplay').textContent);
        localStorage.setItem('totalSpeakers', totalSpeakersProcessed);
      } catch (e) {
        console.warn('Failed to save to localStorage:', e);
      }
    }

    function loadFromStorage() {
      try {
        const savedOnes = localStorage.getItem('queueOnes');
        const savedTwos = localStorage.getItem('queueTwos');
        const savedCurrent = localStorage.getItem('currentSpeaker');
        const savedTotal = localStorage.getItem('totalSpeakers');
        
        if (savedOnes) queueOnes = JSON.parse(savedOnes);
        if (savedTwos) queueTwos = JSON.parse(savedTwos);
        if (savedCurrent && savedCurrent !== 'None') {
          document.getElementById('currentSpeakerDisplay').textContent = savedCurrent;
        }
        if (savedTotal) totalSpeakersProcessed = parseInt(savedTotal);
        updateQueueDisplay();
      } catch (e) {
        console.warn('Failed to load from localStorage:', e);
        // Reset to empty arrays if data is corrupted
        queueOnes = [];
        queueTwos = [];
      }
    }

    function clearStorage() {
      try {
        localStorage.removeItem('queueOnes');
        localStorage.removeItem('queueTwos');
        localStorage.removeItem('currentSpeaker');
        localStorage.removeItem('totalSpeakers');
      } catch (e) {
        console.warn('Failed to clear localStorage:', e);
      }
    }

    /* ===== Undo History System ===== */
    let undoStack = [];
    const MAX_UNDO_HISTORY = 10;

    function addToUndoStack(action) {
      undoStack.push(action);
      if (undoStack.length > MAX_UNDO_HISTORY) {
        undoStack.shift(); // Remove oldest
      }
      updateUndoButton();
    }

    function undoLastAction() {
      if (undoStack.length === 0) return;
      
      const action = undoStack.pop();
      
      switch(action.type) {
        case 'DELETE_ONE':
          queueOnes.splice(action.index, 0, action.speaker);
          break;
        case 'DELETE_TWO':
          queueTwos.splice(action.index, 0, action.speaker);
          break;
        case 'CLEAR_ONES':
          queueOnes = action.speakers;
          break;
        case 'CLEAR_TWOS':
          queueTwos = action.speakers;
          break;
      }
      
      updateQueueDisplay();
      saveToStorage();
      updateUndoButton();
      showNotification('Action undone');
    }

    function updateUndoButton() {
      const btn = document.getElementById('undoBtn');
      if (btn) {
        btn.disabled = undoStack.length === 0;
        btn.style.opacity = undoStack.length === 0 ? '0.5' : '1';
      }
    }

    /***********************
     * Speaker Queue Logic *
     ***********************/
    let queueTwos = [];
    let queueOnes = [];
    let totalSpeakersProcessed = 0;

    // Load saved data when app starts
    window.addEventListener('DOMContentLoaded', () => {
      loadFromStorage();
    });

    function updateQueueDisplay() {
      const speakerList1 = document.getElementById('speakerList1');
      const speakerList2 = document.getElementById('speakerList2');
      speakerList1.innerHTML = "";
      speakerList2.innerHTML = "";

      // Priority 1 Queue
      queueOnes.forEach((speakerObj, index) => {
        const li = document.createElement('li');
        li.className = 'speaker-item';
        if (speakerObj.skipped) li.classList.add('skipped');
        
        const nameSpan = document.createElement('span');
        nameSpan.className = 'speaker-item-name';
        nameSpan.textContent = speakerObj.name;
        
        const controls = document.createElement('div');
        controls.className = 'speaker-item-controls';
        
        // Move Up button
        const moveUpBtn = document.createElement('button');
        moveUpBtn.textContent = '‚ñ≤';
        moveUpBtn.className = 'reorder-btn';
        moveUpBtn.disabled = index === 0;
        moveUpBtn.setAttribute('aria-label', `Move ${speakerObj.name} up`);
        moveUpBtn.addEventListener('click', () => {
          if (index > 0) {
            [queueOnes[index], queueOnes[index - 1]] = [queueOnes[index - 1], queueOnes[index]];
            updateQueueDisplay();
            saveToStorage();
          }
        });
        
        // Move Down button
        const moveDownBtn = document.createElement('button');
        moveDownBtn.textContent = '‚ñº';
        moveDownBtn.className = 'reorder-btn';
        moveDownBtn.disabled = index === queueOnes.length - 1;
        moveDownBtn.setAttribute('aria-label', `Move ${speakerObj.name} down`);
        moveDownBtn.addEventListener('click', () => {
          if (index < queueOnes.length - 1) {
            [queueOnes[index], queueOnes[index + 1]] = [queueOnes[index + 1], queueOnes[index]];
            updateQueueDisplay();
            saveToStorage();
          }
        });
        
        // Skip button
        const skipBtn = document.createElement('button');
        skipBtn.textContent = speakerObj.skipped ? 'Unskip' : 'Skip';
        skipBtn.className = 'skip-btn';
        skipBtn.setAttribute('aria-label', `${speakerObj.skipped ? 'Unskip' : 'Skip'} ${speakerObj.name}`);
        skipBtn.addEventListener('click', () => {
          speakerObj.skipped = !speakerObj.skipped;
          updateQueueDisplay();
          saveToStorage();
        });
        
        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.textContent = '‚úï';
        removeBtn.className = 'remove-btn';
        removeBtn.setAttribute('aria-label', `Remove ${speakerObj.name} from queue`);
        removeBtn.addEventListener('click', () => {
          addToUndoStack({
            type: 'DELETE_ONE',
            speaker: { ...speakerObj },
            index: index
          });
          queueOnes.splice(index, 1);
          updateQueueDisplay();
          saveToStorage();
          showNotification(`${speakerObj.name} removed`);
        });
        
        controls.appendChild(moveUpBtn);
        controls.appendChild(moveDownBtn);
        controls.appendChild(skipBtn);
        controls.appendChild(removeBtn);
        li.appendChild(nameSpan);
        li.appendChild(controls);
        speakerList1.appendChild(li);
      });

      // Priority 2 Queue
      queueTwos.forEach((speakerObj, index) => {
        const li = document.createElement('li');
        li.className = 'speaker-item';
        if (speakerObj.skipped) li.classList.add('skipped');
        
        const nameSpan = document.createElement('span');
        nameSpan.className = 'speaker-item-name';
        nameSpan.textContent = speakerObj.name;
        
        const controls = document.createElement('div');
        controls.className = 'speaker-item-controls';
        
        // Move Up button
        const moveUpBtn = document.createElement('button');
        moveUpBtn.textContent = '‚ñ≤';
        moveUpBtn.className = 'reorder-btn';
        moveUpBtn.disabled = index === 0;
        moveUpBtn.setAttribute('aria-label', `Move ${speakerObj.name} up`);
        moveUpBtn.addEventListener('click', () => {
          if (index > 0) {
            [queueTwos[index], queueTwos[index - 1]] = [queueTwos[index - 1], queueTwos[index]];
            updateQueueDisplay();
            saveToStorage();
          }
        });
        
        // Move Down button
        const moveDownBtn = document.createElement('button');
        moveDownBtn.textContent = '‚ñº';
        moveDownBtn.className = 'reorder-btn';
        moveDownBtn.disabled = index === queueTwos.length - 1;
        moveDownBtn.setAttribute('aria-label', `Move ${speakerObj.name} down`);
        moveDownBtn.addEventListener('click', () => {
          if (index < queueTwos.length - 1) {
            [queueTwos[index], queueTwos[index + 1]] = [queueTwos[index + 1], queueTwos[index]];
            updateQueueDisplay();
            saveToStorage();
          }
        });
        
        // Skip button
        const skipBtn = document.createElement('button');
        skipBtn.textContent = speakerObj.skipped ? 'Unskip' : 'Skip';
        skipBtn.className = 'skip-btn';
        skipBtn.setAttribute('aria-label', `${speakerObj.skipped ? 'Unskip' : 'Skip'} ${speakerObj.name}`);
        skipBtn.addEventListener('click', () => {
          speakerObj.skipped = !speakerObj.skipped;
          updateQueueDisplay();
          saveToStorage();
        });
        
        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.textContent = '‚úï';
        removeBtn.className = 'remove-btn';
        removeBtn.setAttribute('aria-label', `Remove ${speakerObj.name} from queue`);
        removeBtn.addEventListener('click', () => {
          addToUndoStack({
            type: 'DELETE_TWO',
            speaker: { ...speakerObj },
            index: index
          });
          queueTwos.splice(index, 1);
          updateQueueDisplay();
          saveToStorage();
          showNotification(`${speakerObj.name} removed`);
        });
        controls.appendChild(moveUpBtn);
        controls.appendChild(moveDownBtn);
        controls.appendChild(skipBtn);
        controls.appendChild(removeBtn);
        li.appendChild(nameSpan);
        li.appendChild(controls);
        speakerList2.appendChild(li);
      });

      // Update stats
      const queuedCount = queueOnes.length + queueTwos.length;
      document.getElementById('queuedSpeakersCount').textContent = queuedCount;
      document.getElementById('totalSpeakersCount').textContent = totalSpeakersProcessed;
    }

    function addSpeaker1() {
      const input = document.getElementById('speakerName1');
      const name = input.value.trim();
      if (!name) { showNotification("Please enter a name for Priority 1 speaker."); return; }
      queueOnes.push({ name, skipped: false });
      input.value = "";
      updateQueueDisplay();
      saveToStorage();

      // Add success animation
      const list = document.getElementById('speakerList1');
      list.classList.add('success');
      setTimeout(() => list.classList.remove('success'), 500);
    }

    function addSpeaker2() {
      const input = document.getElementById('speakerName2');
      const name = input.value.trim();
      if (!name) { showNotification("Please enter a name for Priority 2 speaker."); return; }
      queueTwos.push({ name, skipped: false });
      input.value = "";
      updateQueueDisplay();
      saveToStorage();

      // Add success animation
      const list = document.getElementById('speakerList2');
      list.classList.add('success');
      setTimeout(() => list.classList.remove('success'), 500);
    }

    document.getElementById('addSpeakerBtn1').addEventListener('click', addSpeaker1);
    document.getElementById('addSpeakerBtn2').addEventListener('click', addSpeaker2);
    document.getElementById('speakerName1').addEventListener('keydown', (e) => { if (e.key === 'Enter') addSpeaker1(); });
    document.getElementById('speakerName2').addEventListener('keydown', (e) => { if (e.key === 'Enter') addSpeaker2(); });

    document.getElementById('nextSpeakerBtn').addEventListener('click', () => {
      let nextSpeaker = getNextSpeaker(queueTwos);
      if (!nextSpeaker) nextSpeaker = getNextSpeaker(queueOnes);
      if (nextSpeaker) {
        document.getElementById('currentSpeakerDisplay').textContent = nextSpeaker;
        totalSpeakersProcessed++;
      } else showNotification("No speakers in the queue.");
      updateQueueDisplay();
      saveToStorage();
      resetTimer1();
      startTimer1();
    });

    document.getElementById('clearAllDataBtn').addEventListener('click', () => {
      const totalInQueue = queueOnes.length + queueTwos.length;
      const message = totalInQueue > 0 
        ? `Clear all ${totalInQueue} speakers and reset? This cannot be undone.`
        : "Clear all data and reset? This cannot be undone.";
        
      if (confirm(message)) {
        queueOnes = [];
        queueTwos = [];
        totalSpeakersProcessed = 0;
        document.getElementById('currentSpeakerDisplay').textContent = 'None';
        clearStorage();
        updateQueueDisplay();
        showNotification('All data cleared');
      }
    });

    function getNextSpeaker(queue) {
      while (queue.length > 0 && queue[0].skipped) queue.shift();
      if (queue.length > 0) return queue.shift().name;
      return null;
    }

    document.getElementById('clearOnesBtn').addEventListener('click', () => {
      if (queueOnes.length === 0) return;
      
      addToUndoStack({
        type: 'CLEAR_ONES',
        speakers: [...queueOnes]
      });
      
      queueOnes = []; 
      updateQueueDisplay(); 
      saveToStorage();
      showNotification('Priority 1 queue cleared');
    });

    document.getElementById('clearTwosBtn').addEventListener('click', () => {
      if (queueTwos.length === 0) return;
      
      addToUndoStack({
        type: 'CLEAR_TWOS',
        speakers: [...queueTwos]
      });
      
      queueTwos = []; 
      updateQueueDisplay();
      saveToStorage();
      showNotification('Priority 2 queue cleared');
    });
    
    // Undo button event listener and initialization
    document.getElementById('undoBtn').addEventListener('click', undoLastAction);
    updateUndoButton();

    /* ===== Accessible Notification System ===== */
    let soundEnabled = true;
    function showNotification(message) {
      const notif = document.getElementById('notification');
      notif.textContent = message;
      notif.classList.add('show');
      
      setTimeout(() => {
        notif.classList.remove('show');
      }, 4000);
    }

    // Play a single beep
    function playBeep(frequency = 800, duration = 200) {
      return new Promise((resolve) => {
        if (!soundEnabled) {
          resolve();
          return;
        }
        
        try {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          oscillator.frequency.value = frequency;
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
          
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration / 1000);
          
          setTimeout(() => resolve(), duration);
        } catch (error) {
          console.warn('Audio playback failed:', error);
          resolve();
        }
      });
    }

    // Play multiple beeps in sequence
    async function playBeepSequence(count, frequency = 800, duration = 200, gap = 150) {
      if (!soundEnabled) return;
      
      for (let i = 0; i < count; i++) {
        await playBeep(frequency, duration);
        if (i < count - 1) {
          await new Promise(resolve => setTimeout(resolve, gap));
        }
      }
    }

    // Warning sound - 1 beep
    function playWarningSound() {
      playBeepSequence(1, 800, 200);
    }

    // Timer complete sound - 3 beeps
    function playTimerCompleteSound() {
      playBeepSequence(3, 800, 200, 150);
    }

    // General notification sound - 2 beeps
    function playNotificationSound() {
      playBeepSequence(2, 800, 200, 150);
    }

    // Sound toggle button
    document.getElementById('soundToggle').addEventListener('click', function() {
      soundEnabled = !soundEnabled;
      this.textContent = soundEnabled ? 'üîä' : 'üîá';
      this.setAttribute('aria-label', soundEnabled ? 'Mute notification sound' : 'Unmute notification sound');
      showNotification(soundEnabled ? 'Sound enabled' : 'Sound muted');
    });

    /********************
     * Timer 1
     ********************/
    let timerDuration1 = 60;
    let timerRemaining1 = timerDuration1;
    let timerInterval1 = null;

    const circleProgress1 = document.querySelector('#timerCircle1 .timer-progress');
    const circleCircumference1 = 2 * Math.PI * 50;

    function updateTimerDisplay1() {
      const timerDisplay1 = document.getElementById('timerDisplay1');
      const timerSection = document.getElementById('timerSection1');
      const minutes1 = Math.floor(timerRemaining1 / 60);
      const seconds1 = timerRemaining1 % 60;
      const timeString1 = String(minutes1).padStart(2,'0') + ":" + String(seconds1).padStart(2,'0');
      timerDisplay1.textContent = timeString1;
      
      // Update progress circle
      const fraction1 = timerDuration1 > 0 ? timerRemaining1 / timerDuration1 : 1;
      circleProgress1.style.strokeDashoffset = circleCircumference1 * (1 - fraction1);
      
      // Visual warnings
      timerSection.classList.remove('timer-warning', 'timer-critical');
      if (timerRemaining1 <= 10 && timerRemaining1 > 5) {
        timerSection.classList.add('timer-warning');
      } else if (timerRemaining1 <= 5 && timerRemaining1 > 0) {
        timerSection.classList.add('timer-critical');
      }
    }

    function startTimer1() {
      if (timerInterval1 !== null) return;
      timerInterval1 = setInterval(() => {
        if (timerRemaining1 > 0) {
          timerRemaining1--;
          updateTimerDisplay1();
          
          // Warnings at specific times
          if (timerRemaining1 === 10) {
            showNotification('Timer 1: 10 seconds remaining');
            playWarningSound();
          }
        } else {
          clearInterval(timerInterval1);
          timerInterval1 = null;
          showNotification("Timer 1: Time's up!");
          playTimerCompleteSound();
          document.getElementById('timerSection1').classList.remove('timer-warning', 'timer-critical');
        }
      }, 1000);
    }

    function pauseTimer1() { if (timerInterval1 !== null) { clearInterval(timerInterval1); timerInterval1 = null; } }
    function resetTimer1() { pauseTimer1(); timerRemaining1 = timerDuration1; updateTimerDisplay1(); }

    document.querySelectorAll('#timerControls1 .preset').forEach(btn => {
      btn.addEventListener('click', () => { timerDuration1 = parseInt(btn.getAttribute('data-seconds')); resetTimer1(); });
    });
    document.getElementById('setCustomTimeBtn1').addEventListener('click', () => {
      const m = parseInt(document.getElementById('customMinutes1').value) || 0;
      const s = parseInt(document.getElementById('customSeconds1').value) || 0;
      const total = m * 60 + s;
      if (total <= 0) { showNotification("Please enter a valid time for Timer 1."); return; }
      timerDuration1 = total; resetTimer1();
      document.getElementById('customMinutes1').value = "";
      document.getElementById('customSeconds1').value = "";
    });
    document.getElementById('add30SecsBtn1').addEventListener('click', () => {
      timerRemaining1 += 30; updateTimerDisplay1(); showNotification('Added 30 seconds to Timer 1'); playNotificationSound();
    });
    document.getElementById('startTimerBtn1').addEventListener('click', startTimer1);
    document.getElementById('pauseTimerBtn1').addEventListener('click', pauseTimer1);
    document.getElementById('resetTimerBtn1').addEventListener('click', resetTimer1);

    circleProgress1.style.strokeDasharray = circleCircumference1;
    updateTimerDisplay1();

    /********************
     * Timer 2
     ********************/
    let timerDuration2 = 60;
    let timerRemaining2 = timerDuration2;
    let timerInterval2 = null;

    const circleProgress2 = document.querySelector('#timerCircle2 .timer-progress');
    const circleCircumference2 = 2 * Math.PI * 50;

    function updateTimerDisplay2() {
      const timerDisplay2 = document.getElementById('timerDisplay2');
      const timerSection = document.getElementById('timerSection2');
      const minutes2 = Math.floor(timerRemaining2 / 60);
      const seconds2 = timerRemaining2 % 60;
      const timeString2 = String(minutes2).padStart(2,'0') + ":" + String(seconds2).padStart(2,'0');
      timerDisplay2.textContent = timeString2;
      const fraction2 = timerDuration2 > 0 ? timerRemaining2 / timerDuration2 : 1;
      circleProgress2.style.strokeDashoffset = circleCircumference2 * (1 - fraction2);
      // Visual warnings
      timerSection.classList.remove('timer-warning', 'timer-critical');
      if (timerRemaining2 <= 10 && timerRemaining2 > 5) {
        timerSection.classList.add('timer-warning');
      } else if (timerRemaining2 <= 5 && timerRemaining2 > 0) {
        timerSection.classList.add('timer-critical');
      }
    }

    function startTimer2() {
      if (timerInterval2 !== null) return;
      timerInterval2 = setInterval(() => {
        if (timerRemaining2 > 0) { 
          timerRemaining2--; 
          updateTimerDisplay2();
          if (timerRemaining2 === 10) {
            showNotification('Timer 2: 10 seconds remaining');
            playWarningSound();
          }
        }
        else { 
          clearInterval(timerInterval2); 
          timerInterval2 = null; 
          showNotification("Timer 2: Time's up!"); 
          playTimerCompleteSound();
          document.getElementById('timerSection2').classList.remove('timer-warning', 'timer-critical');
        }
      }, 1000);
    }
    function pauseTimer2() { if (timerInterval2 !== null) { clearInterval(timerInterval2); timerInterval2 = null; } }
    function resetTimer2() { pauseTimer2(); timerRemaining2 = timerDuration2; updateTimerDisplay2(); }

    document.querySelectorAll('#timerControls2 .preset').forEach(btn => {
      btn.addEventListener('click', () => { timerDuration2 = parseInt(btn.getAttribute('data-seconds')); resetTimer2(); });
    });
    document.getElementById('setCustomTimeBtn2').addEventListener('click', () => {
      const m = parseInt(document.getElementById('customMinutes2').value) || 0;
      const s = parseInt(document.getElementById('customSeconds2').value) || 0;
      const total = m * 60 + s;
      if (total <= 0) { showNotification("Please enter a valid time for Timer 2."); return; }
      timerDuration2 = total; resetTimer2();
      document.getElementById('customMinutes2').value = "";
      document.getElementById('customSeconds2').value = "";
    });
    document.getElementById('add30SecsBtn2').addEventListener('click', () => {
      timerRemaining2 += 30; updateTimerDisplay2(); showNotification('Added 30 seconds to Timer 2'); playNotificationSound();
    });
    document.getElementById('startTimerBtn2').addEventListener('click', startTimer2);
    document.getElementById('pauseTimerBtn2').addEventListener('click', pauseTimer2);
    document.getElementById('resetTimerBtn2').addEventListener('click', resetTimer2);

    circleProgress2.style.strokeDasharray = circleCircumference2;
    updateTimerDisplay2();

    /* ===== Keyboard Shortcuts ===== */
    document.getElementById('keyboardShortcutsBtn').addEventListener('click', () => {
      document.getElementById('shortcutsModal').style.display = 'flex';
    });

    document.addEventListener('keydown', (e) => {
      // Don't trigger if typing in an input
      if (e.target.tagName === 'INPUT') return;
      
      switch(e.key.toLowerCase()) {
        case ' ':
          e.preventDefault();
          if (timerInterval1 === null) startTimer1();
          else pauseTimer1();
          break;
        case 'n':
          document.getElementById('nextSpeakerBtn').click();
          break;
        case 'r':
          resetTimer1();
          break;
        case 'm':
          document.getElementById('soundToggle').click();
          break;
        case 'z':
          if (e.ctrlKey || e.metaKey) { // Ctrl+Z or Cmd+Z
            e.preventDefault();
            undoLastAction();
          }
          break;
        case '1':
          document.getElementById('speakerName1').focus();
          break;
        case '2':
          document.getElementById('speakerName2').focus();
          break;
        case 'escape':
          document.getElementById('shortcutsModal').style.display = 'none';
          break;
      }
    });
  </script>
</body>
</html>